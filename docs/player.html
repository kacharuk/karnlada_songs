<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Player - Karnlada Songs</title>
<meta name="description" content="Music player">
<style>
/* minimal styles reused from previous players */
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px}
.player-container{background:rgba(255,255,255,.95);border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.3);max-width:400px;width:100%;overflow:hidden;backdrop-filter:blur(10px)}
.album-art{width:100%;aspect-ratio:1;object-fit:cover;display:block}
.player-info{padding:30px;text-align:center}
.song-title{font-size:24px;font-weight:700;color:#2d3748;margin-bottom:8px;line-height:1.3}
.artist-name{font-size:18px;color:#718096;margin-bottom:25px}
.audio-controls{width:100%;margin-top:20px;outline:none}
audio{width:100%;height:40px;border-radius:20px}
.status{margin-top:15px;font-size:14px;color:#a0aec0;font-style:italic}
.status.loading{color:#667eea}.status.playing{color:#48bb78}.status.error{color:#f56565}
</style>
</head>
<body>
<div class="player-container" id="player">
	<img src="" alt="album art" class="album-art" id="albumArt">
	<div class="player-info">
		<h1 class="song-title" id="songTitle">Loading...</h1>
		<p class="artist-name" id="artistName"></p>
		<audio id="audioPlayer" class="audio-controls" controls>
			Your browser does not support the audio element.
		</audio>
		<div class="status" id="status">Loading...</div>
	</div>
</div>

<script>
async function fetchJSON(path){
	try{
		const r = await fetch(path);
		if(!r.ok) throw new Error('Fetch failed');
		return await r.json();
	}catch(e){
		console.error(e);
		return null;
	}
}

function getQueryParam(name){
	const params = new URLSearchParams(location.search);
	return params.get(name);
}

function setStatus(text, cls=''){
	const s = document.getElementById('status');
	s.textContent = text;
	s.className = 'status' + (cls? ' ' + cls : '');
}

function selectFile(files, id){
	if(!id) return files[0];
	// if id is numeric index
	if(/^\d+$/.test(id)){
		const idx = parseInt(id,10)-1;
		return files[idx] || files[0];
	}
	// try matching by filename or title
	for(const f of files){
		if(f.html_filename === id || f.html_filename.replace('.html','') === id) return f;
		if(f.title === id) return f;
	}
	return files[0];
}

(async function(){
	const filesData = await fetchJSON('onedrive_files.json');
	if(!filesData || !filesData.files || filesData.files.length===0){
		setStatus('No files found', 'error');
		return;
	}
	const files = filesData.files;
	const id = getQueryParam('id');
	const file = selectFile(files, id);

	// populate UI
	document.getElementById('songTitle').textContent = file.title;
	document.getElementById('artistName').textContent = file.artist;
	const art = document.getElementById('albumArt');
	art.src = file.album_art_url || 'images/album_art_karnlada.jpg';
	art.alt = file.title + ' album art';

	const audioEl = document.getElementById('audioPlayer');
	// clear existing sources
	while(audioEl.firstChild) audioEl.removeChild(audioEl.firstChild);
	const src = document.createElement('source');
	src.src = file.audio_url;
	src.type = 'audio/mpeg';
	audioEl.appendChild(src);
	// optional mp4 source
	const src2 = document.createElement('source');
	src2.src = file.audio_url;
	src2.type = 'audio/mp4';
	audioEl.appendChild(src2);

	// events
	audioEl.addEventListener('loadstart', ()=> setStatus('Loading audio...', 'loading'));
	audioEl.addEventListener('canplay', ()=> setStatus('Ready to play'));
	audioEl.addEventListener('playing', ()=> setStatus('Now playing', 'playing'));
	audioEl.addEventListener('pause', ()=> setStatus('Paused'));
	audioEl.addEventListener('ended', ()=> setStatus('Song ended'));
	audioEl.addEventListener('error', ()=> setStatus('Error loading audio', 'error'));

	// try to autoplay if allowed
	try{ await audioEl.play(); }catch(e){ setStatus('Click play to start'); }
})();
</script>
</body>
</html>
